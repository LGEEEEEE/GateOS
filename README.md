# üõ°Ô∏è GateOS - Smart Gate Pro
> Sistema de Controle de Acesso IoT Multi-Condom√≠nio (SaaS)

O **GateOS** √© uma solu√ß√£o completa para automatiza√ß√£o de port√µes eletr√¥nicos. Diferente de solu√ß√µes caseiras, ele utiliza uma arquitetura **Centralizada em Nuvem**, permitindo gerenciar m√∫ltiplos condom√≠nios/clientes usando um √∫nico servidor e um √∫nico cluster MQTT.

---

## üèóÔ∏è Arquitetura do Sistema

O sistema opera no modelo **Single-Cluster / Multi-Tenant**:

1.  **Hardware (ESP32):** Instalado no cliente. Gera um ID √∫nico (Serial Number) baseado no MAC Address. Conecta-se via MQTT.
2.  **Broker (HiveMQ Cloud):** "Correio" central. Recebe mensagens de todos os port√µes e entrega para o Backend.
3.  **Backend (Render + Node.js):** O c√©rebro. Gerencia usu√°rios, permiss√µes e envia comandos de abertura.
4.  **Database (Supabase):** Armazena cadastros de .

üõ°Ô∏è GateOS - Smart Gate Pro
Sistema de Controle de Acesso IoT Multi-Condom√≠nio (SaaS)

O GateOS √© uma solu√ß√£o completa para automatiza√ß√£o de port√µes eletr√¥nicos. Diferente de solu√ß√µes caseiras, ele utiliza uma arquitetura Centralizada em Nuvem, permitindo gerenciar m√∫ltiplos condom√≠nios/clientes usando um √∫nico servidor e um √∫nico cluster MQTT.

üèóÔ∏è Arquitetura do Sistema
O sistema opera no modelo Single-Cluster / Multi-Tenant:

Hardware (ESP32): Instalado no cliente. Gera um ID √∫nico (Serial Number) baseado no MAC Address e conecta-se via MQTT.

Broker (HiveMQ Cloud): "Correio" central. Recebe mensagens de todos os port√µes e entrega para o Backend.

Backend (Render + Node.js): O c√©rebro. Gerencia usu√°rios, permiss√µes e envia comandos de abertura.

Database (Supabase): Armazena cadastros de moradores, logs de acesso e v√≠nculo entre Usu√°rios e Port√µes.

üöÄ Parte 1: Configura√ß√£o da Nuvem (Fa√ßa uma vez)
Antes de vender para o primeiro cliente, configure sua "Sede Digital".

1. Banco de Dados (Supabase)
Crie um projeto no Supabase.

V√° em SQL Editor e rode o script de cria√ß√£o de tabelas abaixo:

SQL

-- Tabela de Dispositivos (Port√µes F√≠sicos)
create table devices (
  serial_number text primary key,
  nome_local text not null,
  status_atual text default 'DESCONHECIDO',
  updated_at timestamp with time zone default timezone('utc'::text, now())
);

-- Tabela de Usu√°rios (Moradores/S√≠ndicos)
create table users (
  id uuid default gen_random_uuid() primary key,
  email text unique not null,
  senha_hash text not null,
  nome text,
  role text default 'user' -- 'admin' ou 'user'
);

-- Permiss√µes (Quem abre o qu√™)
create table permissions (
  id bigint generated by default as identity primary key,
  user_id uuid references users(id) on delete cascade,
  device_serial text references devices(serial_number) on delete cascade,
  unique(user_id, device_serial)
);

-- Logs de Acesso
create table logs (
  id bigint generated by default as identity primary key,
  device_serial text,
  user_email text,
  acao text,
  data_hora timestamp with time zone default timezone('utc'::text, now())
);
2. Mensageria (HiveMQ Cloud)
Crie um cluster gratuito no HiveMQ.

Em Access Management, crie um usu√°rio mestre (ex: admin_gateos e senha).

Anote a URL do Cluster (ex: xxx.s1.eu.hivemq.cloud) e a porta (8883).

3. Backend (Render)
Conecte seu reposit√≥rio GitHub ao Render.

Crie um Web Service.

Adicione as seguintes Environment Variables:

Vari√°vel	Valor Exemplo	Descri√ß√£o
NODE_ENV	production	For√ßa uso do Supabase
SUPABASE_URL	https://xyz.supabase.co	URL do seu projeto Supabase
SUPABASE_KEY	eyJxhMz...	Sua Key service_role ou anon
MQTT_URL	mqtts://user:pass@url:8883	String de conex√£o completa do HiveMQ
JWT_SECRET	segredo_super_dificil	Para criptografar sess√µes

Exportar para as Planilhas

üõ†Ô∏è Parte 2: Hardware (O Produto)
Prepara√ß√£o do ESP32
Abra o arquivo ControlePortao.ino na Arduino IDE.

Instale as bibliotecas necess√°rias:

PubSubClient (Nick O'Leary)

WiFiManager (tzapu)

Fa√ßa o Upload para a placa ESP32.

Dica de Produ√ß√£o: Voc√™ pode pr√©-configurar as credenciais do MQTT no c√≥digo se quiser facilitar a instala√ß√£o, ou deixar para configurar via portal Wi-Fi no local.

üì¶ Parte 3: Instala√ß√£o no Cliente (Passo a Passo)
Siga este roteiro ao chegar no condom√≠nio do cliente:

1. Instala√ß√£o F√≠sica
Conecte o Rel√© ao motor do port√£o (Contato Seco / Botoeira).

Conecte o Sensor de Fim de Curso (Opcional, mas recomendado).

Ligue o ESP32 na energia.

2. Configura√ß√£o Wi-Fi (Pelo Celular)
O ESP32 criar√° uma rede Wi-Fi chamada SETUP_GATE_XXXXXX.

Conecte-se a ela com a senha padr√£o (12345678 ou a definida no c√≥digo).

O navegador abrir√° automaticamente (ou acesse 192.168.4.1).

IMPORTANTE: Copie o Serial Number exibido no topo da tela (ex: A1B2C3).

Configure:

Wi-Fi do Condom√≠nio.

Dados do MQTT (Se n√£o estiverem fixos no c√≥digo).

Salve. O dispositivo ir√° reiniciar e ficar online.

3. Cadastro no Sistema (Pelo seu Painel)
Acesse seu sistema (ex: https://gateos.onrender.com).

Fa√ßa login como Administrador.

Clique em Adicionar Dispositivo (+).

Cole o Serial Number (A1B2C3) e d√™ um nome (ex: "Condom√≠nio Solar").

Pronto! O port√£o est√° vinculado. Agora voc√™ pode criar usu√°rios para os moradores e dar permiss√£o para esse Serial.

üö® Troubleshooting (Resolu√ß√£o de Problemas)
O dispositivo perdeu o Wi-Fi:

Segure o bot√£o BOOT do ESP32 por 5 segundos ao ligar. O LED piscar√° indicando que as configura√ß√µes foram resetadas. A rede SETUP_GATE aparecer√° novamente.

O site diz "Erro ao Conectar":

Verifique se o Render n√£o "dormiu" (no plano free, o primeiro acesso demora 50s).

Verifique os Logs do Render para ver se a conex√£o com o Supabase/HiveMQ caiu.

üìù Licen√ßa
Desenvolvido para uso comercial exclusivo GateOS.moradores, logs de acesso e v√≠nculo entre Usu√°rios e Port√µes.

---

## üöÄ Parte 1: Configura√ß√£o da Nuvem (Fa√ßa uma vez)

Antes de vender para o primeiro cliente, configure sua "Sede Digital".

### 1. Banco de Dados (Supabase)
1. Crie um projeto no [Supabase](https://supabase.com/).
2. V√° em **SQL Editor** e rode o script de cria√ß√£o de tabelas:

```sql
-- Tabela de Dispositivos (Port√µes F√≠sicos)
create table devices (
  serial_number text primary key,
  nome_local text not null,
  status_atual text default 'DESCONHECIDO',
  updated_at timestamp with time zone default timezone('utc'::text, now())
);

-- Tabela de Usu√°rios (Moradores/S√≠ndicos)
create table users (
  id uuid default gen_random_uuid() primary key,
  email text unique not null,
  senha_hash text not null,
  nome text,
  role text default 'user' -- 'admin' ou 'user'
);

-- Permiss√µes (Quem abre o qu√™)
create table permissions (
  id bigint generated by default as identity primary key,
  user_id uuid references users(id) on delete cascade,
  device_serial text references devices(serial_number) on delete cascade,
  unique(user_id, device_serial)
);

-- Logs de Acesso
create table logs (
  id bigint generated by default as identity primary key,
  device_serial text,
  user_email text,
  acao text,
  data_hora timestamp with time zone default timezone('utc'::text, now())
);
2. Mensageria (HiveMQ Cloud)Crie um cluster gratuito no HiveMQ.Em Access Management, crie um usu√°rio mestre (ex: admin_gateos e senha).Anote a URL do Cluster (ex: xxx.s1.eu.hivemq.cloud) e a porta (8883).3. Backend (Render)Conecte seu reposit√≥rio GitHub ao Render.Crie um Web Service.Adicione as seguintes Environment Variables:Vari√°velValor ExemploDescri√ß√£oNODE_ENVproductionFor√ßa uso do SupabaseSUPABASE_URLhttps://xyz.supabase.coURL do seu projeto SupabaseSUPABASE_KEYeyJxhMz...Sua Key service_role ou anonMQTT_URLmqtts://user:pass@url:8883String de conex√£o completa do HiveMQJWT_SECRETsegredo_super_dificilPara criptografar sess√µesüõ†Ô∏è Parte 2: Hardware (O Produto)Prepara√ß√£o do ESP32Abra o arquivo ControlePortao.ino na Arduino IDE.Instale as bibliotecas necess√°rias:PubSubClient (Nick O'Leary)WiFiManager (tzapu)Fa√ßa o Upload para a placa ESP32.Dica de Produ√ß√£o: Voc√™ pode pr√©-configurar as credenciais do MQTT no c√≥digo se quiser facilitar a instala√ß√£o, ou deixar para configurar via portal Wi-Fi no local.üì¶ Parte 3: Instala√ß√£o no Cliente (Passo a Passo)Siga este roteiro ao chegar no condom√≠nio do cliente:1. Instala√ß√£o F√≠sicaConecte o Rel√© ao motor do port√£o (Contato Seco / Botoeira).Conecte o Sensor de Fim de Curso (Opcional, mas recomendado).Ligue o ESP32 na energia.2. Configura√ß√£o Wi-Fi (Pelo Celular)O ESP32 criar√° uma rede Wi-Fi chamada SETUP_GATE_XXXXXX.Conecte-se a ela com a senha padr√£o (12345678 ou a definida no c√≥digo).O navegador abrir√° automaticamente (ou acesse 192.168.4.1).IMPORTANTE: Copie o Serial Number exibido no topo da tela (ex: A1B2C3).Configure:Wi-Fi do Condom√≠nio.Dados do MQTT (Se n√£o estiverem fixos no c√≥digo).Salve. O dispositivo ir√° reiniciar e ficar online.3. Cadastro no Sistema (Pelo seu Painel)Acesse seu sistema (ex: https://gateos.onrender.com).Fa√ßa login como Administrador.Clique em Adicionar Dispositivo (+).Cole o Serial Number (A1B2C3) e d√™ um nome (ex: "Condom√≠nio Solar").Pronto! O port√£o est√° vinculado. Agora voc√™ pode criar usu√°rios para os moradores e dar permiss√£o para esse Serial.üö® Troubleshooting (Resolu√ß√£o de Problemas)O dispositivo perdeu o Wi-Fi:Segure o bot√£o BOOT do ESP32 por 5 segundos ao ligar. O LED piscar√° indicando que as configura√ß√µes foram resetadas. A rede SETUP_GATE aparecer√° novamente.O site diz "Erro ao Conectar":Verifique se o Render n√£o "dormiu" (no plano free, o primeiro acesso demora 50s).Verifique os Logs do Render para ver se a conex√£o com o Supabase/HiveMQ caiu.üìù Licen√ßaDesenvolvido para uso comercial exclusivo GateOS.